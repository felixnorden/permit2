// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

import {Script} from "forge-std/Script.sol";

/// @notice helper to deploy permit2 from precompiled bytecode
/// @dev useful if testing externally against permit2 and want to avoid
/// recompiling entirely and requiring viaIR compilation
contract DeployPermit2 is Script {
    address constant PERMIT2_ADDRESS = 0x000000000022D473030F116dDEE9F6B43aC78BA3;

    function deployPermit2() public returns (address) {
        return run();
    }

    function run() public returns (address) {
        bytes memory bytecode =
            hex"6040608081526004908136101561001557600080fd5b600090813560e01c80630d58b1db14611242578063137c29fe1461104b5780632a2d80d114610db35780632b67b57014610bda57806330f28b7a14610ada5780633644e51514610a9957806336c7851614610a245780633ff9dcb1146109a45780634fe02b441461093b57806365d9723c146107a857806387517c4514610676578063927da105146105bf578063cc53287f1461049f578063edd9444b146103355763fe8ec1a7146100c657600080fd5b346103315760c07ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126103315767ffffffffffffffff833581811161032d576101149036908601611623565b6024358281116103295761012b90369087016115f2565b6101336114be565b916084358581116103255761014b9036908a01611599565b98909560a4359081116103215761016491369101611599565b969095815190610173826113d7565b606b82527f5065726d697442617463685769746e6573735472616e7366657246726f6d285460208301527f6f6b656e5065726d697373696f6e735b5d207065726d69747465642c61646472838301527f657373207370656e6465722c75696e74323536206e6f6e63652c75696e74323560608301527f3620646561646c696e652c000000000000000000000000000000000000000000608083015282519a8b918161022260208501809661197a565b918237018a8152039961025b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe09b8c810183528261140f565b5190209085515161026b81611a77565b908a5b8181106102f95750506102f6999a6102ed9183516102a081610294602082018095611ac6565b0384810183528261140f565b519020602089810151858b015195519182019687526040820192909252336060820152608081019190915260a081019390935260643560c08401528260e081015b0390810183528261140f565b51902093611ff2565b80f35b8061031061030a6001938c51611737565b516121cc565b61031a8286611737565b520161026e565b8880fd5b8780fd5b8480fd5b8380fd5b5080fd5b5091346103315760807ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126103315767ffffffffffffffff90803582811161032d576103869036908301611623565b6024358381116103295761039d90369084016115f2565b9390926103a86114be565b9160643590811161049b576103bf91369101611599565b949093835151976103cf89611a77565b98885b8181106104785750506102f697988151610420816103f4602082018095611ac6565b037fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0810183528261140f565b5190206020860151828701519083519260208401947ffcf35f5ac6a2c28868dc44c302166470266239195f02b0ee408334829333b7668652840152336060840152608083015260a082015260a081526102ed816113f3565b808b6104948261048e61030a6001968d51611737565b92611737565b52016103d2565b8680fd5b5082346105bb57602090817ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261032d5780359067ffffffffffffffff8211610329576104f0913691016115f2565b929091845b848110610500578580f35b806105166105116001938888611835565b611845565b61052b84610525848a8a611835565b01611845565b3389528385528589209173ffffffffffffffffffffffffffffffffffffffff80911692838b528652868a20911690818a5285528589207fffffffffffffffffffffffff000000000000000000000000000000000000000081541690558551918252848201527f89b1add15eff56b3dfe299ad94e01f2b52fbcb80ae1a3baea6ae8c04cb2b98a4853392a2016104f5565b8280fd5b50346103315760607ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261033157610672816105fb611478565b9361060461149b565b61060c6114be565b73ffffffffffffffffffffffffffffffffffffffff968716835260016020908152848420928816845291825283832090871683528152919020549251938316845260a083901c65ffffffffffff169084015260d09190911c604083015281906060820190565b0390f35b50346103315760807ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc360112610331576106ae611478565b906106b761149b565b916106c06114be565b65ffffffffffff92606435848116908181036103255779ffffffffffff0000000000000000000000000000000000000000947fda9fa7c1b00402c17d0161b249b1ab8bbec047c5a52207b9c112deffd817036b94338a5260016020527fffffffffffff0000000000000000000000000000000000000000000000000000858b209873ffffffffffffffffffffffffffffffffffffffff809416998a8d5260205283878d209b169a8b8d52602052868c209486156000146107a057504216925b8454921697889360a01b16911617179055815193845260208401523392a480f35b90509261077f565b5082346105bb5760607ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126105bb576107e1611478565b906107ea61149b565b9265ffffffffffff604435818116939084810361032557338852602091600183528489209673ffffffffffffffffffffffffffffffffffffffff80911697888b528452858a20981697888a5283528489205460d01c93848711156109135761ffff9085840316116108ec5750907f55eb90d810e1700b35a8e7e25395ff7f2b2259abd7415ca2284dfb1c246418f393929133895260018252838920878a528252838920888a5282528389209079ffffffffffffffffffffffffffffffffffffffffffffffffffff7fffffffffffff000000000000000000000000000000000000000000000000000083549260d01b16911617905582519485528401523392a480f35b84517f24d35a26000000000000000000000000000000000000000000000000000000008152fd5b5084517f756688fe000000000000000000000000000000000000000000000000000000008152fd5b503461033157807ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc360112610331578060209273ffffffffffffffffffffffffffffffffffffffff61098b611478565b1681528084528181206024358252845220549051908152f35b5082346105bb57817ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126105bb577f3704902f963766a4e561bbaab6e6cdc1b1dd12f6e9e99648da8843b3f46b918d90359160243533855284602052818520848652602052818520818154179055815193845260208401523392a280f35b8234610a965760807ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc360112610a9657610a5c611478565b610a6461149b565b610a6c6114be565b6064359173ffffffffffffffffffffffffffffffffffffffff83168303610329576102f693611866565b80fd5b503461033157817ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261033157602090610ad361177a565b9051908152f35b508290346105bb576101007ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126105bb57610b1636611502565b90807fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7c36011261032d57610b48611450565b9160e43567ffffffffffffffff8111610bd6576102f694610b6b91369101611599565b939092610b7883516121cc565b6020840151828501519083519260208401947f939c21a48a8dbe3a9a2404a1d46691e4d39f6583d6ec6b35714604c986d801068652840152336060840152608083015260a082015260a08152610bcd816113f3565b519020916119a5565b8580fd5b509134610331576101007ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261033157610c14611478565b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdc360160c0811261032d576080855191610c4d836113bb565b1261032d57845190610c5e82611370565b73ffffffffffffffffffffffffffffffffffffffff91602435838116810361049b578152604435838116810361049b57602082015265ffffffffffff60643581811681036103255788830152608435908116810361049b576060820152815260a435938285168503610bd6576020820194855260c4359087830182815260e43567ffffffffffffffff811161032157610cfa9036908401611599565b929093804211610d84575050918591610d746102f6999a610d7a95610d1f885161229d565b90898c511690519083519260208401947ff3841cd1ff0085026a6327b620b67997ce40f282c88a8e905a7a5626e310f3d086528401526060830152608082015260808152610d6c816113d7565b519020611af3565b91611b55565b5192511691611e71565b602492508a51917fcd21db4f000000000000000000000000000000000000000000000000000000008352820152fd5b509134610331576060907ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc9060608236011261032d57610df1611478565b926024359167ffffffffffffffff9384841161049b576060908436030112610bd657865196610e1f886113bb565b8382013585811161032557840136602382011215610325578281013590610e45826115c7565b91610e528451938461140f565b80835260209560248785019260071b8401019236841161104757602401915b838310610feb575050505088526044610e8c602486016114e1565b94848a019586520135928189019584875260443590811161032157610eb49036908501611599565b939094804211610fbc5750508897985151610ece81611a77565b908a5b818110610f8f57505082889492610d7492610f5c979551610ef9816103f48582018095611ac6565b51902073ffffffffffffffffffffffffffffffffffffffff998a8a51169051918451938401947faf1b0d30d2cab0380e68f0689007e3254993c596f2fdd0aaa7f4d04f7944086386528401526060830152608082015260808152610d6c816113d7565b51169082515192845b848110610f70578580f35b80610f898585610f836001958751611737565b51611e71565b01610f65565b80610fa8610fa26001938e9f9e51611737565b5161229d565b610fb28286611737565b52019a999a610ed1565b602492508351917fcd21db4f000000000000000000000000000000000000000000000000000000008352820152fd5b6080833603126110475787608091875161100481611370565b61100d866114e1565b815261101a8387016114e1565b838201526110298987016115df565b898201526110388587016115df565b85820152815201920191610e71565b8b80fd5b5082346105bb576101407ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126105bb5761108636611502565b91807fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7c36011261032d576110b8611450565b67ffffffffffffffff93906101043585811161049b576110db9036908601611599565b909361012435968711610325576110fb610bcd966102f698369101611599565b96909582519061110a826113d7565b606482527f5065726d69745769746e6573735472616e7366657246726f6d28546f6b656e5060208301527f65726d697373696f6e73207065726d69747465642c6164647265737320737065848301527f6e6465722c75696e74323536206e6f6e63652c75696e7432353620646561646c60608301527f696e652c0000000000000000000000000000000000000000000000000000000060808301528351948591816111b960208501809661197a565b918237018b815203936111f27fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe09586810183528261140f565b5190209261120086516121cc565b6020878101518589015195519182019687526040820192909252336060820152608081019190915260a081019390935260e43560c08401528260e081016102e1565b5082346105bb576020807ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261032d57813567ffffffffffffffff92838211610bd65736602383011215610bd6578101359283116103295760249060073660248660071b8401011161049b57865b8581106112bd578780f35b80821b83019060807fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdc83360301126103215761136a88876001946060835161130481611370565b61134060846113148d86016114e1565b94858452611324604482016114e1565b8097850152611335606482016114e1565b8098850152016114e1565b918291015273ffffffffffffffffffffffffffffffffffffffff8080809316951693169116611866565b016112b2565b6080810190811067ffffffffffffffff82111761138c57604052565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6060810190811067ffffffffffffffff82111761138c57604052565b60a0810190811067ffffffffffffffff82111761138c57604052565b60c0810190811067ffffffffffffffff82111761138c57604052565b90601f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0910116810190811067ffffffffffffffff82111761138c57604052565b60c4359073ffffffffffffffffffffffffffffffffffffffff8216820361147357565b600080fd5b6004359073ffffffffffffffffffffffffffffffffffffffff8216820361147357565b6024359073ffffffffffffffffffffffffffffffffffffffff8216820361147357565b6044359073ffffffffffffffffffffffffffffffffffffffff8216820361147357565b359073ffffffffffffffffffffffffffffffffffffffff8216820361147357565b7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc01906080821261147357604080519061153b826113bb565b8082941261147357805181810181811067ffffffffffffffff82111761138c57825260043573ffffffffffffffffffffffffffffffffffffffff81168103611473578152602435602082015282526044356020830152606435910152565b9181601f840112156114735782359167ffffffffffffffff8311611473576020838186019501011161147357565b67ffffffffffffffff811161138c5760051b60200190565b359065ffffffffffff8216820361147357565b9181601f840112156114735782359167ffffffffffffffff8311611473576020808501948460061b01011161147357565b91909160608184031261147357604080519161163e836113bb565b829481359067ffffffffffffffff9182811161147357830181601f8201121561147357803560209361166f826115c7565b9361167c8851958661140f565b828552858086019360061b85010193818511611473579086899897969594939201925b8484106116bc575050505050855280820135908501520135910152565b909192939495969784830312611473578851908982019082821085831117611709578a92899284526116ed876114e1565b815282870135838201528152019301919088979695949361169f565b602460007f4e487b710000000000000000000000000000000000000000000000000000000081526041600452fd5b805182101561174b5760209160051b010190565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b467f0000000000000000000000000000000000000000000000000000000000007a69036117c5577fd5a17abc3865df5c1400c0299bd4ce2eefc8114aec5f9d3dded1745783e57b9890565b60405160208101907f8cad95687ba82c2ce50e74f7b754645e5117c3a5bec8151c0726d5857980a86682527f9ac997416e8ff9d2ff6bebeb7149f65cdae5e32e2b90440b566bb3044041d36a60408201524660608201523060808201526080815261182f816113d7565b51902090565b919081101561174b5760061b0190565b3573ffffffffffffffffffffffffffffffffffffffff811681036114735790565b92919273ffffffffffffffffffffffffffffffffffffffff604060008284168152600160205282828220961695868252602052818120338252602052209485549565ffffffffffff8760a01c168042116119495750828716968388036118d7575b50506118d595501692612115565b565b878484161160001461191457602488604051907ff96fb0710000000000000000000000000000000000000000000000000000000082526004820152fd5b7fffffffffffffffffffffffff000000000000000000000000000000000000000084846118d59a0316911617905538806118c7565b602490604051907fd81b2f2e0000000000000000000000000000000000000000000000000000000082526004820152fd5b9081519160005b838110611992575050016000815290565b8060208092840101518185015201611981565b9192909360a435936040840151804211611a465750602084510151808611611a155750918591610d746119e5946119e0602088015186612229565b611af3565b73ffffffffffffffffffffffffffffffffffffffff8091515116926084359182168203611473576118d593612115565b602490604051907f3728b83d0000000000000000000000000000000000000000000000000000000082526004820152fd5b602490604051907fcd21db4f0000000000000000000000000000000000000000000000000000000082526004820152fd5b90611a81826115c7565b611a8e604051918261140f565b8281527fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0611abc82946115c7565b0190602036910137565b805160208092019160005b828110611adf575050505090565b835185529381019392810192600101611ad1565b611afb61177a565b906040519060208201927f19010000000000000000000000000000000000000000000000000000000000008452602283015260428201526042815261182f81611370565b9190826040910312611473576020823592013590565b6000843b611ceb575060418203611c3a57611b7282820182611b3f565b9390926040101561174b5760209360009360ff6040608095013560f81c5b60405194855216868401526040830152606082015282805260015afa15611c2e5773ffffffffffffffffffffffffffffffffffffffff8060005116918215611c04571603611bda57565b60046040517f815e1d64000000000000000000000000000000000000000000000000000000008152fd5b60046040517f8baa579f000000000000000000000000000000000000000000000000000000008152fd5b6040513d6000823e3d90fd5b60408203611cc157611c4e91810190611b3f565b91601b7f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff84169360ff1c019060ff8211611c925760209360009360ff608094611b90565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b60046040517f4be6321b000000000000000000000000000000000000000000000000000000008152fd5b929391601f928173ffffffffffffffffffffffffffffffffffffffff60646020957fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0604051988997889687947f1626ba7e000000000000000000000000000000000000000000000000000000009e8f8752600487015260406024870152816044870152868601378b85828601015201168101030192165afa908115611e66578291611de7575b507fffffffff0000000000000000000000000000000000000000000000000000000091501603611dbd57565b60046040517fb0669cbc000000000000000000000000000000000000000000000000000000008152fd5b90506020813d602011611e5e575b81611e026020938361140f565b810103126103315751907fffffffff0000000000000000000000000000000000000000000000000000000082168203610a9657507fffffffff000000000000000000000000000000000000000000000000000000009038611d91565b3d9150611df5565b6040513d84823e3d90fd5b9065ffffffffffff908160608401511673ffffffffffffffffffffffffffffffffffffffff908185511694826020820151169280866040809401511695169560009187835260016020528383208984526020528383209916988983526020528282209184835460d01c03611fc9579185611fa294927fc6a377bfc4eb120024a8ac08eef205be16b817020812c73223e81d1bdb9708ec98979694508715600014611fa75779ffffffffffff00000000000000000000000000000000000000009042165b60a01b167fffffffffffff00000000000000000000000000000000000000000000000000006001860160d01b1617179055519384938491604091949373ffffffffffffffffffffffffffffffffffffffff606085019616845265ffffffffffff809216602085015216910152565b0390a4565b5079ffffffffffff000000000000000000000000000000000000000087611f34565b600484517f756688fe000000000000000000000000000000000000000000000000000000008152fd5b95909395805151956040926040830151804211611a4657508488036120eb5761202b918691610d7460209b6119e0602088015186612229565b60005b86811061203f575050505050505050565b61204a818351611737565b518861205783878a611835565b013590898101518083116120bb575091818888886001968596612081575b5050505050500161202e565b6120b0956120aa9273ffffffffffffffffffffffffffffffffffffffff61051193511695611835565b91612115565b803888888883612075565b6024908651907f3728b83d0000000000000000000000000000000000000000000000000000000082526004820152fd5b60046040517fff633a38000000000000000000000000000000000000000000000000000000008152fd5b9060006064926020958295604051947f23b872dd0000000000000000000000000000000000000000000000000000000086526004860152602485015260448401525af13d15601f3d116001600051141617161561216e57565b60646040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152601460248201527f5452414e534645525f46524f4d5f4641494c45440000000000000000000000006044820152fd5b6040516020808201927f618358ac3db8dc274f0cd8829da7e234bd48cd73c4a740aede1adec9846d06a1845273ffffffffffffffffffffffffffffffffffffffff8151166040840152015160608201526060815261182f81611370565b9073ffffffffffffffffffffffffffffffffffffffff600160ff83161b9216600052600060205260406000209060081c600052602052604060002081815418809155161561227357565b60046040517f756688fe000000000000000000000000000000000000000000000000000000008152fd5b60405160208101917f65626cad6cb96493bf6f5ebea28756c966f023ab9e8a83a7101849d5573b3678835273ffffffffffffffffffffffffffffffffffffffff8082511660408401526020820151166060830152606060408201519165ffffffffffff809316608085015201511660a082015260a0815260c0810181811067ffffffffffffffff82111761138c576040525190209056fea164736f6c6343000819000a";

        vm.etch(PERMIT2_ADDRESS, bytecode);
        return PERMIT2_ADDRESS;
    }
}
